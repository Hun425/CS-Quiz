# CS-Quiz ë°±ì—”ë“œ ë¦¬íŒ©í† ë§ ê²€í†  ë³´ê³ ì„œ
**ì‘ì„±ì¼**: 2024.06.23  
**ê²€í† ì**: CTO ê´€ì ì—ì„œì˜ ì½”ë“œ ë¶„ì„  
**ìš°ì„ ìˆœìœ„**: 1) ê°€ë…ì„± 2) í™•ì¥ì„± 3) ì„±ëŠ¥

## ğŸ“‹ Executive Summary

CS-Quiz ë°±ì—”ë“œ í”„ë¡œì íŠ¸ì˜ ì „ë°˜ì ì¸ ì½”ë“œ í’ˆì§ˆì€ ì–‘í˜¸í•˜ë‚˜, ì¼ë¶€ í´ë˜ìŠ¤ì—ì„œ ë‹¨ì¼ ì±…ì„ ì›ì¹™(SRP) ìœ„ë°˜ê³¼ ë³µì¡ë„ ì¦ê°€ê°€ ê´€ì°°ë©ë‹ˆë‹¤. íŠ¹íˆ TestDataInitializer, ì¼ë¶€ ë„ë©”ì¸ ì—”í‹°í‹°, Repository í´ë˜ìŠ¤ë“¤ì—ì„œ ë¦¬íŒ©í† ë§ì´ í•„ìš”í•œ ë¶€ë¶„ë“¤ì´ ì‹ë³„ë˜ì—ˆìŠµë‹ˆë‹¤.

## ğŸ” ìƒì„¸ ë¶„ì„

### 1. ê°€ë…ì„± ê°œì„  ì‚¬í•­ (ìš°ì„ ìˆœìœ„ 1)

#### 1.1 TestDataInitializer í´ë˜ìŠ¤ ë¶„í•´ í•„ìš” â­â­â­â­â­
**ë¬¸ì œì :**
- 306ì¤„ì˜ ê±°ëŒ€ í´ë˜ìŠ¤ë¡œ ë„ˆë¬´ ë§ì€ ì±…ì„ì„ ê°€ì§
- SQL ì‹¤í–‰, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ì˜ˆì œ ID ì„¤ì •, ë°ì´í„° ê²€ì¦ ë“± ì—¬ëŸ¬ ê´€ì‹¬ì‚¬ í˜¼ì¬

**ë¦¬íŒ©í† ë§ ì œì•ˆ:**
```java
// ë¶„ë¦¬ ë°©ì•ˆ
1. SqlFileExecutor - SQL íŒŒì¼ ì‹¤í–‰ ì „ë‹´
2. TestDataValidator - ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ ê²€ì¦
3. ExampleIdProvider - Swagger ì˜ˆì œ ID ì œê³µ
4. TestDataInitializationService - ì „ì²´ ì´ˆê¸°í™” íë¦„ ê´€ë¦¬
```

#### 1.2 ë„ë©”ì¸ ì—”í‹°í‹° ë³µì¡ë„ ê°œì„  â­â­â­â­
**BattleRoom í´ë˜ìŠ¤ (638ì¤„):**
```java
// í˜„ì¬ ë¬¸ì œì : ë„ˆë¬´ ë§ì€ public ë©”ì„œë“œ (38ê°œ)
// ì œì•ˆ: ë‚´ë¶€ ìƒíƒœ ê´€ë¦¬ ë¡œì§ì„ ë³„ë„ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬

public class BattleRoomStateManager {
    public boolean canStart(BattleRoom room) { ... }
    public void transitionToInProgress(BattleRoom room) { ... }
    public void handleTimeout(BattleRoom room) { ... }
}

public class BattleQuestionManager {
    public Question getNextQuestion(BattleRoom room) { ... }
    public boolean allParticipantsAnswered(BattleRoom room) { ... }
}
```

**BattleParticipant í´ë˜ìŠ¤ (560ì¤„):**
```java
// ì œì•ˆ: ì ìˆ˜ ê³„ì‚° ë¡œì§ ë¶„ë¦¬
public class BattleScoreCalculator {
    public int calculateTotalPoints(Question question, int timeSpent, int streak) { ... }
    public int calculateTimeBonus(int timeSpent, int timeLimit) { ... }
    public int calculateStreakBonus(int streak) { ... }
}
```

#### 1.3 ë§¤ì§ë„˜ë²„ ë° ìƒìˆ˜ ê°œì„  â­â­â­
**í˜„ì¬ ë¬¸ì œì :**
```java
// BattleParticipant.java
private static final int STREAK_BONUS_THRESHOLD_1 = 3;
private static final int STREAK_BONUS_THRESHOLD_2 = 5;
private static final int STREAK_BONUS_POINTS_1 = 3;
private static final int STREAK_BONUS_POINTS_2 = 5;
```

**ê°œì„  ì œì•ˆ:**
```java
// ë³„ë„ ì„¤ì • í´ë˜ìŠ¤ ìƒì„±
@ConfigurationProperties(prefix = "quiz.battle.scoring")
public class BattleScoringConfig {
    private int streakBonusThreshold1 = 3;
    private int streakBonusThreshold2 = 5;
    private int streakBonusPoints1 = 3;
    private int streakBonusPoints2 = 5;
    // getter/setter
}
```

#### 1.4 ë©”ì„œë“œ ê¸¸ì´ ê°œì„  â­â­â­
**Question.isCorrectAnswer() ë©”ì„œë“œ (87ì¤„):**
- í˜„ì¬ í•˜ë‚˜ì˜ ë©”ì„œë“œì—ì„œ ëª¨ë“  ì§ˆë¬¸ íƒ€ì… ì²˜ë¦¬
- íƒ€ì…ë³„ ì „ëµ íŒ¨í„´ ì ìš© ì œì•ˆ

```java
public interface AnswerValidator {
    boolean validate(String userAnswer, String correctAnswer, List<OptionDto> options);
}

public class MultipleChoiceValidator implements AnswerValidator { ... }
public class TrueFalseValidator implements AnswerValidator { ... }
public class ShortAnswerValidator implements AnswerValidator { ... }
```

### 2. í™•ì¥ì„± ê°œì„  ì‚¬í•­ (ìš°ì„ ìˆœìœ„ 2)

#### 2.1 Repository ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬ â­â­â­â­
**QuizRepository (255ì¤„):**
- ë„ˆë¬´ ë§ì€ ë©”ì„œë“œë¡œ ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬ ì›ì¹™(ISP) ìœ„ë°˜
- ë‹¨ì¼ í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë©”ì„œë“œë“¤ì— ì˜ì¡´

**ê°œì„  ì œì•ˆ:**
```java
public interface QuizBasicRepository extends JpaRepository<Quiz, Long> {
    // ê¸°ë³¸ CRUD ë©”ì„œë“œë“¤
}

public interface QuizSearchRepository {
    // ê²€ìƒ‰ ê´€ë ¨ ë©”ì„œë“œë“¤
    Page<Quiz> findByTags(Tag tag, Pageable pageable);
    List<Quiz> findByQuizTypeAndValidUntilAfter(QuizType quizType, LocalDateTime dateTime);
}

public interface QuizStatisticsRepository {
    // í†µê³„ ê´€ë ¨ ë©”ì„œë“œë“¤
    Double calculateAverageDifficultyByTagIds(Set<Long> tagIds);
    int countByTagIds(Set<Long> tagIds);
}

public interface DailyQuizRepository {
    // ë°ì¼ë¦¬ í€´ì¦ˆ ê´€ë ¨ ë©”ì„œë“œë“¤
    Optional<Quiz> findCurrentDailyQuiz(LocalDateTime now);
    List<Quiz> findEligibleQuizzesForDaily(LocalDateTime since);
}
```

#### 2.2 ì„¤ì • ì™¸ë¶€í™” â­â­â­
**í˜„ì¬ ë¬¸ì œì :** í•˜ë“œì½”ë”©ëœ SQL íŒŒì¼ ê²½ë¡œ
```java
private static final List<String> SQL_FILES = Arrays.asList(
    "classpath:dummy/new.sql",
    "classpath:dummy/new2.sql", ...);
```

**ê°œì„  ì œì•ˆ:**
```yaml
# application.yml
quiz:
  data-initialization:
    enabled: true
    sql-files:
      - "classpath:dummy/new.sql"
      - "classpath:dummy/new2.sql"
    batch-size: 1000
```

#### 2.3 ìºì‹± ì „ëµ êµ¬ì²´í™” â­â­â­
**í˜„ì¬ ìƒíƒœ:** Caffeine ìºì‹œ ì„¤ì •ì€ ìˆìœ¼ë‚˜ ì ìš© ë²”ìœ„ ë¶ˆëª…í™•

**ê°œì„  ì œì•ˆ:**
```java
@Service
@CacheConfig(cacheNames = "quiz")
public class QuizService {
    
    @Cacheable(key = "#id", condition = "#id != null")
    public QuizDetailResponse getQuizDetail(Long id) { ... }
    
    @CacheEvict(key = "#quiz.id")
    public Quiz updateQuiz(Quiz quiz) { ... }
}
```

### 3. ì„±ëŠ¥ ê°œì„  ì‚¬í•­ (ìš°ì„ ìˆœìœ„ 3)

#### 3.1 N+1 ë¬¸ì œ í•´ê²° â­â­â­â­
**QuizRepositoryì˜ ë³µì¡í•œ ì¿¼ë¦¬ë“¤:**
```java
// í˜„ì¬: ì—¬ëŸ¬ ë²ˆì˜ fetch join
@Query("SELECT q FROM Quiz q " +
       "LEFT JOIN FETCH q.questions " +
       "LEFT JOIN FETCH q.tags " +
       "LEFT JOIN FETCH q.creator " +
       "WHERE q.id = :id")

// ê°œì„ : DTO í”„ë¡œì ì…˜ + ë³„ë„ ì—°ê´€ê´€ê³„ ë¡œë”©
@Query("SELECT new QuizDetailProjection(q.id, q.title, ...) FROM Quiz q WHERE q.id = :id")
```

#### 3.2 ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™” â­â­â­
**ì œì•ˆì‚¬í•­:**
```sql
-- ìì£¼ ì‚¬ìš©ë˜ëŠ” ê²€ìƒ‰ ì¡°ê±´ë“¤ì— ëŒ€í•œ ë³µí•© ì¸ë±ìŠ¤
CREATE INDEX idx_quiz_type_difficulty ON quizzes(quiz_type, difficulty_level);
CREATE INDEX idx_quiz_tags_active ON quiz_tags(tag_id) WHERE is_active = true;
CREATE INDEX idx_user_email_active ON users(email) WHERE is_active = true;
```

#### 3.3 ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™” â­â­â­
**TestDataInitializerì˜ ëŒ€ëŸ‰ INSERT:**
```java
// í˜„ì¬: ê°œë³„ INSERT
// ê°œì„ : JPA Batch Insert ì„¤ì •
@Configuration
public class JpaBatchConfig {
    @Bean
    @Primary
    public Properties jpaProperties() {
        Properties properties = new Properties();
        properties.setProperty("hibernate.jdbc.batch_size", "1000");
        properties.setProperty("hibernate.order_inserts", "true");
        return properties;
    }
}
```

## ğŸ›  ë¦¬íŒ©í† ë§ ë¡œë“œë§µ

### Phase 1: ê°€ë…ì„± ê°œì„  (2ì£¼)
1. TestDataInitializer í´ë˜ìŠ¤ ë¶„í•´
2. BattleRoom, BattleParticipant ë³µì¡ë„ ê°ì†Œ
3. ë§¤ì§ë„˜ë²„ ìƒìˆ˜í™”
4. ê¸´ ë©”ì„œë“œ ë¶„í• 

### Phase 2: í™•ì¥ì„± ê°•í™” (3ì£¼)
1. Repository ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬
2. ì„¤ì • ì™¸ë¶€í™”
3. ìºì‹± ì „ëµ êµ¬ì²´í™”
4. í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ í™•ë³´

### Phase 3: ì„±ëŠ¥ ìµœì í™” (2ì£¼)
1. N+1 ë¬¸ì œ í•´ê²°
2. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™”
3. ë°°ì¹˜ ì²˜ë¦¬ ê°œì„ 
4. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ìë™í™”

## ğŸ¯ ìš°ì„ ìˆœìœ„ë³„ ê¶Œì¥ì‚¬í•­

### ì¦‰ì‹œ ì‹œí–‰ (High Priority)
- [ ] TestDataInitializer í´ë˜ìŠ¤ ë¶„í•´
- [ ] QuizRepository ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬
- [ ] N+1 ë¬¸ì œ í•´ê²°

### ë‹¨ê¸° ëª©í‘œ (Medium Priority) 
- [ ] ë„ë©”ì¸ ì—”í‹°í‹° ë³µì¡ë„ ê°œì„ 
- [ ] ë§¤ì§ë„˜ë²„ ìƒìˆ˜í™”
- [ ] ìºì‹± ì „ëµ êµ¬ì²´í™”

### ì¥ê¸° ëª©í‘œ (Low Priority)
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ìë™í™”
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ìµœì í™”
- [ ] ë°°ì¹˜ ì²˜ë¦¬ ê°œì„ 

## ğŸ“Š ì˜ˆìƒ íš¨ê³¼

### ê°€ë…ì„±
- í´ë˜ìŠ¤ë‹¹ í‰ê·  ë¼ì¸ ìˆ˜: 300ì¤„ â†’ 150ì¤„
- ë©”ì„œë“œë‹¹ í‰ê·  ë¼ì¸ ìˆ˜: 20ì¤„ â†’ 10ì¤„
- ìˆœí™˜ ë³µì¡ë„: 15 â†’ 8

### í™•ì¥ì„±
- ìƒˆë¡œìš´ ì§ˆë¬¸ íƒ€ì… ì¶”ê°€ ì‹œê°„: 2ì¼ â†’ 0.5ì¼
- ìƒˆë¡œìš´ Repository ë©”ì„œë“œ ì¶”ê°€: ì•ˆì „ì„± í–¥ìƒ
- ì„¤ì • ë³€ê²½ ì‹œ ì¬ë°°í¬ ë¶ˆí•„ìš”

### ì„±ëŠ¥
- í€´ì¦ˆ ìƒì„¸ ì¡°íšŒ ì‘ë‹µ ì‹œê°„: 200ms â†’ 50ms
- ëŒ€ëŸ‰ ë°ì´í„° ì´ˆê¸°í™” ì‹œê°„: 60ì´ˆ â†’ 15ì´ˆ
- ë™ì‹œ ì‚¬ìš©ì ì²˜ë¦¬ ëŠ¥ë ¥: 100ëª… â†’ 500ëª…

## ğŸ”š ê²°ë¡ 

í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ëŠ” ê¸°ëŠ¥ì ìœ¼ë¡œëŠ” ì™„ì„±ë„ê°€ ë†’ìœ¼ë‚˜, ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„± ì¸¡ë©´ì—ì„œ ê°œì„ ì˜ ì—¬ì§€ê°€ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ ë‹¨ì¼ ì±…ì„ ì›ì¹™ê³¼ ì¸í„°í˜ì´ìŠ¤ ë¶„ë¦¬ ì›ì¹™ì„ ì ìš©í•˜ì—¬ ì½”ë“œì˜ ê°€ë…ì„±ê³¼ í™•ì¥ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.

ì œì‹œëœ ë¦¬íŒ©í† ë§ ê³„íšì„ ë‹¨ê³„ì ìœ¼ë¡œ ì‹¤í–‰í•˜ë©´, ì½”ë“œ í’ˆì§ˆ í–¥ìƒê³¼ ë™ì‹œì— ê°œë°œ ìƒì‚°ì„±ë„ í¬ê²Œ ê°œì„ ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.